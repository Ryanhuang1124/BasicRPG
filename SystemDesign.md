###  主要クラス仕様

#### **TextGame（メインクラス）**
```java
// 役割：ゲームループとメニュー管理
- scanner: Scanner                // ユーザー入力
- player: Hero                    // プレイヤー（動的置き換え可能）
- wizardJoined: boolean           // 魔法使い加入フラグ
- running: boolean                // ゲームループフラグ

+ start(): void                   // ゲーム開始
- gameLoop(): void                // メインループ
- showMainMenu(): void            // 村のメニュー
- battle(Character, boolean): void // 戦闘処理
- explore(): void                 // 冒険に出る
```

#### **GameManager**
```java
// 役割：ゲーム進行フラグとプレイヤー管理
- player: Hero                    // 動的に置き換え可能
- demonKingDefeated: boolean      // 魔王撃破フラグ
- evilKingDefeated: boolean       // 邪悪な王撃破フラグ
- gameCleared: boolean            // ゲームクリアフラグ

+ getInstance(): GameManager      // シングルトン取得
+ setPlayer(Hero): void           // 転職時の置き換え
```

#### **SaveManager（CUI版専用）**
```java
// 役割：セーブ/ロード機能
- maxSlots: int = 3               // セーブスロット数

+ save(int, Hero, boolean): void  // セーブ実行
+ load(int): SaveData             // ロード実行
+ hasSaveData(int): boolean       // セーブデータ存在確認
+ getSlotSummary(int): String     // スロット情報表示
```

#### **Hero → SuperHero / TrueHero**
```java
Hero (基底)
├── hp, maxHp, maxAttack, level, exp
├── gainExp(int): boolean         // 経験値獲得
├── sleep(): void                 // HP回復
└── canSleep(): boolean           // 眠れるか判定

SuperHero (継承)
├── isFlying: boolean             // 飛行状態
├── fly(): void / land(): void    // 飛行切替
└── 攻撃力: 40 (×2倍)、飛行能力

TrueHero (継承)
├── rebirthCount: int             // 転生回数
├── baseMaxHp, baseMaxAttack      // 基礎値
├── recalculateStats(): void      // 複利計算
├── canRebirth(): boolean         // 転生可能判定
├── restAtInn(): void             // 村での休憩（眠れる）
└── 成長式: 能力 = 基礎値 × 1.1^(Lv-1)
```

---

## ゲームフロー

### メインループ構造

```
タイトルメニュー
├─ 1. 新規ゲーム → 初期化 → gameLoop()
├─ 2. 続きから → ロード → gameLoop()
└─ 0. 終了

gameLoop() {
  while (running) {
    showMainMenu()  // 村のメニュー
  }
}
```

### 主メニュー構成

```
主メニュー（動的生成）
├─ 魔法使いに会いに行く（常に表示）
├─ 王様に会いに行く（邪悪な王撃破前のみ）
├─ お姫様に会いに行く（魔王撃破後 && 邪悪な王撃破前）
├─ 山奥の庵へ（Lv10以上 && 魔王撃破後）
├─ 冒険に出る（常に表示）
├─ 休憩する（常に表示）
├─ S. セーブ
└─ 0. ゲーム終了
```

### ルート分岐図

```
開始
 ↓
王様からクエスト受注
 ↓
冒険に出る（70%確率で敵遭遇）
 ↓
3種敵撃破 (Slime, Goblin, Werewolf)
 ↓
┌───────────────┴───────────────┐
│                                │
魔法使いと仲間になる（100%）    独力でLv10到達
│                                │
SuperHero転職                   魔王撃破後
│                                │
魔王撃破（お姫様応援30%）       隠士に転職（TrueHero）
│                                │
通常エンディング                真実を知る
                                 ↓
                         Lv10到達 → 転生ループ可能
                                 ↓
                         邪悪な王撃破（お姫様洗脳30%）
                                 ↓
                         真エンディング
                                 ↓
                   (20%確率) 隠士決闘
                                 ↓
                   真の真エンディング
```

---

##  ゲームシステム仕様

###  転生システム

| 項目 | 仕様 |
|------|------|
| **条件** | TrueHeroがレベル10到達 |
| **効果** | レベル1にリセット、現在の能力を基礎値として継承 |
| **成長式** | 能力値 = 基礎値 × 1.1^(レベル-1) |
| **回数** | 無制限 |
| **表示** | 真勇者★1, 真勇者★2... |

**数値例**：
```
初回転職: Lv1, HP 100, 攻撃 20
→ Lv10: HP 234, 攻撃 47
→ 転生: Lv1, HP 234, 攻撃 47 (継承)
→ Lv10: HP 548, 攻撃 110
→ 転生: Lv1, HP 548, 攻撃 110 (継承)
...無限ループ
```

### NPCの二面性

#### **Princess（お姫様）**
| 場面 | 役割 | 効果 |
|------|------|------|
| 魔王戦 | 味方 | SuperHero攻撃力×2（30%確率） |
| 王様戦 | 敵 | King攻撃力×2（30%確率、最大200万） |

#### **King（王様）**
| 段階 | 名前 | 正体 | ステータス |
|------|------|------|------------|
| 序盤 | 王様 | クエスト発行者 | - |
| 暴露後 | 邪悪な王 | 真の黒幕 | HP 100万、攻撃 100万 |

#### **Hermit（隠士）**
| 機能 | 条件 | 効果 |
|------|------|------|
| 転職 | Hero Lv10+ | → TrueHero |
| 転生 | TrueHero Lv10+ | 能力継承リセット |
| 決闘 | 王撃破後 | 20%確率で戦闘（HP 1億） |

### 戦闘システム

#### ターン順
```
プレイヤー → 魔法使い（いる場合） → 敵
```

#### 動的オプションメニュー
```
基本：攻撃、逃げる
Hero：+ 眠る
SuperHero：+ 飛ぶ/着陸
TrueHero：眠る不可（村では休憩可能）

魔法使いターン（選択式）：
1. 魔法攻撃（通常）
2. エクスプロージョン（必殺技）
```

#### 特殊能力
- **SuperHero飛行**：攻撃力半減、回避可能
- **King/Hermit**：飛行無視攻撃
- **Princess応援**：30%確率で味方/敵攻撃力×2
- **魔法使い必殺技**：エクスプロージョン（敵HP大幅減少）

### 敵遭遇システム

```
冒険に出る → 70%確率で敵遭遇

敵出現ルール：
- Hero（Lv9以下）：Slime, Goblin, Werewolf のみ
- SuperHero / TrueHero / Hero Lv10+：+ DemonKing 出現可能
```

---

## データ仕様

### キャラクターパラメータ

| クラス | HP | 攻撃力 | 経験値 | 特殊能力 |
|--------|----|----|--------|----------|
| Hero | 100 | 20 | - | 眠る |
| SuperHero | 100 | 40 | - | 飛行 |
| TrueHero | 100→∞ | 20→∞ | - | 複利成長、転生 |
| Wizard | 50 | 30 | - | 2vs1援護、必殺技 |
| King | 1,000,000 | 1,000,000 | なし | 絶対王権 |
| Hermit | 100,000,000 | 0 | なし | 最大HP20%攻撃 |
| Slime | 30 | 10 | 1 | - |
| Goblin | 50 | 20 | 2 | - |
| Werewolf | 60 | 40 | 5 | - |
| DemonKing | 150 | 100 | 50 | - |

### セーブデータ仕様

**SaveData クラス**：
```java
- playerType: String              // "Hero", "SuperHero", "TrueHero"
- name: String
- hp, maxHp, maxAttack, level, exp
- rebirthCount: int               // TrueHero専用
- wizardJoined: boolean
- demonKingDefeated: boolean
- evilKingDefeated: boolean
- saveDate: String
```

**セーブスロット**：
- スロット数：3
- 保存形式：テキストファイル（`save_slot_X.txt`）
- 保存場所：プロジェクトルート

---

## エンディング仕様

| エンディング | トリガー条件 | テーマ |
|--------------|--------------|--------|
| **通常** | SuperHero + 魔王撃破 | ハッピーエンド |
| **真** | TrueHero + 邪悪な王撃破 | 力の腐敗 |
| **真の真** | 真ED後 + 20%隠士決闘 | 絶対正義への疑問 |

### 通常エンディング
```
勇者は魔王を倒し、
お姫様を救い出した。
国は再び平和を取り戻した。

GAME CLEAR!
(隠しルートもあるよ！)
```

### 真エンディング
```
邪悪な王を倒した...
洗脳されたお姫様も...力尽きた。

真勇者：...私が王になる。

圧倒的な力を手に入れた勇者は、
この国の新たな王となった。

かつて魔王を倒した英雄は、
いつしか誰も逆らえない
絶対的な支配者となった。
```

### 真の真エンディング
```
隠士を...倒した。

もう誰も止められない。
もう誰も逆らえない。

転生を繰り返し、
無限の力を手に入れた者は、

神にも等しい存在となり、
この世界を永遠に支配する。

力を極めた先に待つもの...
それは孤独な支配のみ。
```

---

## UI/UX設計

### 画面構成

#### タイトル画面
```
╔════════════════════════════════════════╗
║                                        ║
║           BasicRPG テキスト版          ║
║         ～ターン制冒険ゲーム～         ║
║                                        ║
╚════════════════════════════════════════╝

1. 新規ゲーム
2. 続きから
0. 終了
```

#### ステータス表示
```
┌──────────────────────────────────────┐
│ 勇者 (真勇者★2)
│ Lv.10 HP: 548/548 EXP: 0/30
│ 攻撃力: 110
│ 仲間: 魔法使い HP: 50/50
└──────────────────────────────────────┘
```

#### 戦闘画面
```
═══════════ 戦闘 ═══════════

【魔王】
  HP: 150/150
  [████████████████████]

【勇者 (スーパー勇者)】
  Lv.10 HP: 100/100
  [████████████████████]
  EXP: 20/30

【魔法使い】
  HP: 50/50
  [████████████████████]

────────────────────────────

1. 攻撃
2. 眠る（HP全回復）
3. 飛ぶ
4. 逃げる
```

### HPバー表示
```java
// 実装例
HP: 75/100
[███████████████░░░░░]  // 20文字、█=満、░=空
```

## 拡張性・保守性

### 設計の利点
- ✅ Factory Patternで敵追加が簡単
- ✅ 継承階層で職業追加可能
- ✅ GameManagerで進行管理が一元化
- ✅ セーブ/ロード機能完備

### CUI版の特徴
- ✅ **完全なセーブ/ロードシステム**（3スロット）
- ✅ **魔法使い必殺技**：エクスプロージョン
- ✅ **TrueHeroの村休憩**：戦闘では眠れないが、村では休憩可能
- ✅ **動的メニュー生成**：ゲーム進行に応じてメニュー項目が変化
- ✅ **HPバー視覚化**：テキストベースのプログレスバー


### 今後の拡張案
- [ ] 装備システム
- [ ] アイテムインベントリ
- [ ] スキルツリー
- [ ] ダンジョンシステム
- [ ] クラウドセーブ
